# 视频截图 Chrome 扩展程序

一个强大的 Chrome 扩展程序，可以自动截取网页上播放的视频画面，并保存到本地。

![版本](https://img.shields.io/badge/版本-1.0.8-blue)
![GitHub](https://img.shields.io/github/license/cj1071/video-screenshot)


## ✨ 主要功能

- 🔍 **智能视频检测**：自动检测网页中的视频元素，包括深层嵌套的iframe
- 📸 **定时截图**：按设定的时间间隔自动截取视频画面
- 🖼️ **图片合并**：支持将多张截图合并为一个HTML文件，便于浏览
- 🔄 **重复检测**：使用高级图像哈希算法检测并跳过重复画面
- 👁️ **人工审核**：支持人工审核截图，选择要保留的图片，提高合并质量
- 🎛️ **可拖拽控制面板**：直接在视频页面上操作，无需切换标签页
- ⏱️ **自动停止**：可设定截图时长，到时自动停止

## 📥 安装方法

### 从Chrome网上应用店安装（推荐）

*待发布后补充链接*

### 手动安装（开发模式）

1. 下载或克隆本仓库到本地
2. 打开Chrome浏览器，进入扩展程序页面：`chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的文件夹

## 🚀 使用方法

1. 打开包含视频的网页
2. 点击Chrome工具栏中的扩展图标，打开配置面板
3. 点击"检测视频"按钮，等待扩展程序检测视频元素
4. 检测到视频后，点击"开始截图"按钮开始截取视频画面
5. 当达到设定的自动停止时间或点击"停止截图"按钮时，会自动弹出审核页面
6. 在审核页面中选择要保留的截图，点击"确认并合并"按钮
7. 合并后的HTML文件将保存到您的默认下载位置
8. 如需手动审核，可随时点击控制面板上的"审核截图"按钮

## ⚙️ 配置选项

### 基本设置

- **截图间隔**：设置截图的时间间隔（秒）
- **图片质量**：设置JPEG图片的质量（1-100）
- **图片格式**：选择PNG或JPEG格式

### 合并选项

- **合并截图数量**：设置多少张截图合并为一个文件
- **合并文件格式**：选择合并文件的格式（HTML）
- **保留原始截图**：是否保留单独的截图文件

### 高级选项

- **自动停止时间**：设置自动停止截图的时间（分钟）
- **启用自动停止**：是否启用自动停止功能
- **重复图片检测阈值**：设置重复图片的相似度阈值（%）
- **启用重复图片检测**：是否启用重复图片检测

## 🔧 技术实现

- 使用Chrome扩展API实现浏览器集成
- 采用内容脚本(Content Script)检测和操作页面元素
- 使用Canvas API截取视频画面
- 实现高级图像哈希算法进行重复检测
- 使用HTML5拖拽API实现可拖拽控制面板

## 📋 版本历史

### 版本 1.0.8
- 添加人工审核截图功能，可以选择要保留的截图
- 达到合并阈值时不再自动合并，而是等待人工审核
- 停止截图或达到自动停止时间时，自动弹出审核页面
- 优化了审核界面，支持全选/取消全选操作
- 解决了可能存在的重复图片问题，提高合并质量

### 版本 1.0.7
- 彻底修复在检测视频结束后仍然继续查找iframe的问题
- 在detectVideos和detectVideosInIframes函数中添加检测状态判断
- 改进了startPeriodicIframeCheck函数，在检测停止时不启动新的定时器

### 版本 1.0.5
- 修改content.js的加载机制，避免在打开配置页面时自动加载
- 使用web_accessible_resources替代content_scripts，只在需要时才注入content.js
- 改进了检测视频按钮的点击事件，先检查content.js是否已注入

更详细的版本历史请查看 [version_history.md](version_history.md)

### 版本 1.0.3
- 修复 "Receiving end does not exist" 通信错误
- 修复 "Cannot access a chrome-extension:// URL of different extension" 错误
- 改进错误处理机制，提供更好的用户反馈
- 添加对扩展页面的检测，避免在扩展页面上尝试使用不支持的功能
- 添加 "tabs" 权限，确保扩展程序能够访问标签页信息

### 版本 1.0.2
- 修复控制面板停止按钮后配置页面开始按钮不恢复可点击状态的问题
- 修复切换到不同网址后检测视频按钮不恢复的问题
- 改进通信机制，确保状态一致性
- 添加更多日志输出，便于调试

### 版本 1.0.1
- 修复检测视频后开始截图按钮不能点击的问题
- 优化状态同步机制
- 添加版本号显示

### 版本 1.0.0
- 初始版本发布
- 实现基本的视频截图功能
- 添加控制面板
- 支持重复图片检测
- 支持自动停止功能

## 📝 注意事项

- 本扩展程序需要网页权限才能访问视频元素
- 某些网站可能会限制视频的访问，导致无法截图
- 截图质量取决于视频的实际分辨率和质量
- 大量截图可能会占用较多磁盘空间，请定期清理

## 🤝 贡献指南

欢迎提交问题报告和功能建议！如果您想贡献代码：

1. Fork本仓库
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m '添加某功能'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建一个Pull Request

## 📜 许可证

本项目采用MIT许可证 - 详情请参见[LICENSE](LICENSE)文件

## 📞 联系方式

如有问题或建议，请通过GitHub Issues提交

---

*此文档最后更新于：2025年4月*
